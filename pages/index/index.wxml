<!--index.wxml-->
<view class="container">
  <!-- å¤´éƒ¨å®šä½ä¿¡æ¯ -->
  <view class="header">
    <view class="location">
      <text class="city">{{cityName}}</text>
      <text class="date">{{today}} {{week}}</text>
    </view>
    <view class="refresh" bindtap="refreshData">
      <text class="iconfont">ğŸ”„</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading">æ•°æ®åŠ è½½ä¸­...</view>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view class="error-container" wx:if="{{error}}">
    <view class="error">{{error}}</view>
    <view class="retry" bindtap="getWeatherData">é‡è¯•</view>
  </view>

  <!-- å¤©æ°”å’Œç©ºæ°”è´¨é‡ä¿¡æ¯ -->
  <block wx:if="{{!loading && !error && weatherInfo && airQuality}}">
    <!-- å¤©æ°”ä¿¡æ¯ -->
    <view class="weather-card">
      <view class="weather-main">
        <view class="temp-wrap">
          <text class="temp">{{weatherInfo.temp}}</text>
          <text class="temp-unit">Â°C</text>
        </view>
        <view class="weather-desc">
          <view class="weather-icon">
            <text class="weather-text">{{weatherInfo.text}}</text>
          </view>
          <view class="weather-feel">ä½“æ„Ÿæ¸©åº¦ {{weatherInfo.feelsLike}}Â°C</view>
        </view>
      </view>
      <view class="weather-detail">
        <view class="detail-item">
          <text class="detail-label">æ¹¿åº¦</text>
          <text class="detail-value">{{weatherInfo.humidity}}%</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">é£å‘</text>
          <text class="detail-value">{{weatherInfo.windDir}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">é£é€Ÿ</text>
          <text class="detail-value">{{weatherInfo.windSpeed}}km/h</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ°”å‹</text>
          <text class="detail-value">{{weatherInfo.pressure}}hPa</text>
        </view>
      </view>
    </view>

    <!-- ç©ºæ°”è´¨é‡ä¿¡æ¯ -->
    <view class="air-card">
      <view class="air-title">ç©ºæ°”è´¨é‡</view>
      <view class="air-content">
        <view class="air-value-container" style="background-color: {{aqiInfo.color}}">
          <text class="air-value">{{airQuality.aqi}}</text>
          <text class="air-level">{{aqiInfo.level}}</text>
        </view>
        <view class="air-detail">
          <view class="air-item">
            <text class="air-label">PM2.5</text>
            <text class="air-item-value">{{airQuality.pm2p5}}</text>
          </view>
          <view class="air-item">
            <text class="air-label">PM10</text>
            <text class="air-item-value">{{airQuality.pm10}}</text>
          </view>
          <view class="air-item">
            <text class="air-label">NOâ‚‚</text>
            <text class="air-item-value">{{airQuality.no2}}</text>
          </view>
          <view class="air-item">
            <text class="air-label">SOâ‚‚</text>
            <text class="air-item-value">{{airQuality.so2}}</text>
          </view>
          <view class="air-item">
            <text class="air-label">Oâ‚ƒ</text>
            <text class="air-item-value">{{airQuality.o3}}</text>
          </view>
          <view class="air-item">
            <text class="air-label">CO</text>
            <text class="air-item-value">{{airQuality.co}}</text>
          </view>
        </view>
      </view>
      <view class="air-suggestion">
        <text>{{aqiInfo.suggestion}}</text>
      </view>
    </view>

    <!-- æ°”æ¸©å’Œæ¹¿åº¦å›¾è¡¨ -->
    <view class="chart-container">
      <view class="chart-box">
        <view class="chart-title">æœªæ¥12å°æ—¶æ¸©åº¦å˜åŒ–</view>
        <canvas canvas-id="tempChart" id="tempChart" class="temp-chart" style="width: 340px; height: 200px;"></canvas>
      </view>
      <view class="chart-box">
        <view class="chart-title">æœªæ¥12å°æ—¶æ¹¿åº¦å˜åŒ–</view>
        <canvas canvas-id="humidityChart" id="humidityChart" class="humidity-chart" style="width: 340px; height: 200px;"></canvas>
      </view>
    </view>

    <!-- æ›´æ–°æ—¶é—´ -->
    <view class="update-time" wx:if="{{showUpdateTime}}">
      <text>æœ€åæ›´æ–°æ—¶é—´: {{weatherInfo.obsTime}}</text>
      <text class="data-source">æ•°æ®æ¥æºï¼šå’Œé£å¤©æ°”</text>
    </view>
    
    <!-- å¼€å‘è€…ä¿¡æ¯ -->
    <view class="developer-info">
      <text class="dev-info-text">2025å¹´è¥¿ç”µBæµ‹ä½œå“</text>
      <text class="dev-info-text">ä½œè€…ï¼šå¢å­æ’ å‘¨æ¨¾ æ›¹å®¶é©¹</text>
      <text class="dev-info-text">Â© 2025 è¥¿å®‰ç”µå­ç§‘æŠ€å¤§å­¦ ä¿ç•™æ‰€æœ‰æƒåˆ©</text>
    </view>
  </block>
</view>
